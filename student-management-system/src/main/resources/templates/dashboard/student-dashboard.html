<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

</head>
<body class="bg-gray-100">
<div class="flex h-screen">
    <!-- Sidebar -->
    <div class="w-72 bg-gradient-to-b from-indigo-800 to-indigo-700 text-white p-6 space-y-6">
        <h2 class="text-2xl font-bold mb-6 text-center">Student Panel</h2>
        <ul class="space-y-4">
            <li><a href="#dashboard" onclick="showSection('dashboard')" class="hover:underline">Dashboard</a></li>
            <li><a href="#allCourses" onclick="showSection('allCourses')" class="hover:underline">Courses</a></li>
            <li><a href="#courses" onclick="showSection('courses')" class="hover:underline">My Courses</a></li>
            <li><a href="#attendance" onclick="showSection('attendance')" class="hover:underline">Attendance</a></li>
            <li><a href="#fees" onclick="showSection('fees')" class="hover:underline">Fee Payment</a></li>
            <li><a href="#profile" onclick="showSection('profile')" class="hover:underline">Profile</a></li>
            <li><a href="#settings" onclick="showSection('settings')" class="hover:underline">Settings</a></li>
        </ul>
    </div>

    <!-- Content Area -->
    <div class="flex-1 p-8 overflow-y-auto">
        <!-- Dashboard Default Section -->
        <div id="dashboard" class="section">
            <h1 class="text-3xl font-bold text-indigo-800 mb-4">Welcome, <span th:text="${studentName}">Student</span>!</h1>
            <p class="text-gray-600">Use the sidebar to navigate through your dashboard options.</p>
        </div>




        <!-- My Courses (Enrolled) -->
        <div id="courses" class="section hidden">
            <h1 class="text-2xl font-bold mb-6 text-indigo-700">My Courses</h1>

            <!-- Semester Filter Dropdown -->
            <div class="mb-4">
                <label class="text-sm font-medium text-gray-700 mr-2">Filter by Semester:</label>
                <select id="myCourseSemesterFilter" onchange="filterMyCourses()"
                        class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="all">All</option>
                    <option th:each="sem : ${uniqueSemesters}" th:value="${sem}" th:text="${sem}"></option>
                </select>
            </div>

            <!-- Course Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div th:if="${#lists.isEmpty(enrolledCourses)}" class="col-span-3 text-gray-500 italic">
                    You are not enrolled in any courses yet.
                </div>

                <div th:each="course : ${enrolledCourses}"
                     class="my-course-card bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300"
                     th:attr="data-semester=${course.semester}">
                    <h2 class="text-lg font-semibold text-indigo-700" th:text="${course.name}">Course Name</h2>
                    <p class="text-sm text-gray-600 mt-1">Code: <span th:text="${course.code}"></span></p>
                    <p class="text-sm text-gray-600">Semester: <span th:text="${course.semester}"></span></p>
                    <p class="text-sm text-gray-600">Department: <span th:text="${course.department}"></span></p>
                    <p class="text-sm text-gray-500 mt-2 italic" th:text="${course.description}">Course description</p>
                </div>
            </div>
        </div>




        <!-- All Available Courses -->
        <div id="allCourses" class="section hidden">
            <h1 class="text-2xl font-bold mb-4 text-indigo-700">All Available Courses</h1>

            <!-- Semester Filter -->
            <div class="mb-6">
                <label for="semesterFilter" class="block mb-2 text-sm font-medium text-gray-700">Filter by Semester:</label>
                <select id="semesterFilter" onchange="filterCourses()" class="w-1/3 p-2 rounded border border-gray-300">
                    <option value="all">All Semesters</option>
                    <th:block th:each="semester : ${uniqueSemesters}">
                        <option th:value="${semester}" th:text="${semester}">Semester</option>
                    </th:block>
                </select>
            </div>

            <!-- Course Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="courseContainer">
                <p th:if="${#lists.isEmpty(courses)}" class="text-gray-500 italic col-span-2">No courses available for your department.</p>
                <div th:each="course : ${courses}" class="course-card bg-white p-6 rounded-2xl shadow-md flex flex-col justify-between"
                     th:data-semester="${course.semester}">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800 mb-2" th:text="${course.name}">Course Name</h2>
                        <p class="text-sm text-gray-600 mb-4" th:text="${course.description}">Description</p>
                        <p class="text-sm text-gray-500">Semester: <span th:text="${course.semester}"></span></p>
                    </div>
                    <form th:action="@{/student/enroll}" method="post" class="inline">
                        <input type="hidden" name="courseCode" th:value="${course.code}" />
                        <button type="submit"
                                th:disabled="${#lists.contains(enrolledCourses, course)}"
                                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                            <span th:text="${#lists.contains(enrolledCourses, course) ? 'Enrolled' : 'Enroll'}"></span>
                        </button>
                    </form>

                </div>
            </div>
        </div>

        <!-- Attendance -->
        <div id="attendance" class="section hidden">
            <h1 class="text-2xl font-bold mb-4 text-indigo-700">Attendance by Course</h1>
            <div class="space-y-6">
                <div th:each="course : ${enrolledCourses}" class="bg-white p-4 rounded-2xl shadow-md">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold text-gray-700" th:text="${course.name}">Course Name</span>
                        <span class="text-sm text-green-600 font-semibold">--%</span>
                    </div>
                    <div class="w-full bg-gray-200 h-3 rounded-full">
                        <div class="bg-green-500 h-3 rounded-full" style="width: 80%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fee Payment -->
        <div id="fees" class="section hidden">
            <h1 class="text-2xl font-bold mb-4 text-indigo-700">Fee Payment</h1>
            <div class="bg-white p-6 rounded-2xl shadow-md">
                <p class="mb-2">Total Fee: <strong>₹50,000</strong></p>
                <p class="mb-4">Paid: <strong>₹40,000</strong></p>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Pay Remaining ₹10,000</button>
            </div>
        </div>

        <!-- Profile -->
        <div id="profile" class="section hidden">
            <h1 class="text-2xl font-bold mb-4 text-indigo-700">My Profile</h1>
            <div class="bg-white p-6 rounded-2xl shadow-md space-y-4">
                <p><strong>ID:</strong> <span th:text="${student != null ? student.id : 'N/A'}">Loading...</span></p>
                <p><strong>Name:</strong> <span th:text="${student != null ? student.name : 'N/A'}">Loading...</span></p>
                <p><strong>Email:</strong> <span th:text="${student != null ? student.email : 'N/A'}">Loading...</span></p>
                <p><strong>Phone:</strong> <span th:text="${student != null ? student.phone : 'N/A'}">Loading...</span></p>
            </div>
        </div>

        <!-- Settings -->
        <div id="settings" class="section hidden">
            <h1 class="text-2xl font-bold mb-4 text-indigo-700">Settings</h1>
            <div class="bg-white p-6 rounded-2xl shadow-md space-y-4">
                <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Change Password</button>
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Logout</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function showSection(id) {
        document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
        const target = document.getElementById(id);
        if (target) {
            target.classList.remove('hidden');
        }
    }

    function filterCourses() {
        const selectedSemester = document.getElementById('semesterFilter').value;
        const cards = document.querySelectorAll('.course-card');
        cards.forEach(card => {
            const semester = card.getAttribute('data-semester');
            if (selectedSemester === 'all' || semester === selectedSemester) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function filterMyCourses() {
        const selectedSemester = document.getElementById('myCourseSemesterFilter').value;
        const cards = document.querySelectorAll('.my-course-card');
        cards.forEach(card => {
            const semester = card.getAttribute('data-semester');
            if (selectedSemester === 'all' || semester === selectedSemester) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    // Show section based on URL hash or default
    document.addEventListener('DOMContentLoaded', () => {
        const initialHash = window.location.hash.substring(1);
        if (initialHash) {
            showSection(initialHash);
        } else {
            showSection('dashboard');
        }
    });
</script>

</body>
</html>
